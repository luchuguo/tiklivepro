# 注册短信验证功能指南

## 功能概述

为了确保用户注册的真实性和安全性，TikLive Pro 平台在达人和企业用户注册过程中增加了短信验证码验证功能。

## 功能特点

### 1. 手机号码验证
- 注册时必须提供有效的手机号码
- 支持中国大陆手机号码格式验证（1开头的11位数字）
- 手机号码格式：`1[3-9]xxxxxxxxx`

### 2. 短信验证码
- 4位数字验证码
- 通过短信宝API发送
- 验证码有效期：5分钟
- 验证成功后才能完成注册

### 3. 用户体验
- 实时验证码发送状态反馈
- 清晰的错误提示信息
- 验证状态可视化显示
- 注册按钮在验证通过前保持禁用状态

## 注册流程

### 步骤1：选择用户类型
用户可以选择注册为：
- **达人主播**：TikTok内容创作者
- **企业用户**：品牌方或商家

### 步骤2：填写基本信息
- 邮箱地址（必填）
- 手机号码（必填）
- 密码（必填，至少6位）
- 确认密码（必填）

### 步骤3：手机号码验证
1. 输入手机号码
2. 点击"发送验证码"按钮
3. 等待短信接收（通常1-3秒）
4. 输入收到的4位验证码
5. 点击"验证"按钮
6. 验证成功后显示"手机号码验证成功"

### 步骤4：完成注册
- 所有信息验证通过后，"注册"按钮变为可用状态
- 点击"注册"按钮完成账号创建
- 系统自动创建用户资料并保存手机号码

## 技术实现

### 短信API配置
```typescript
const SMS_USERNAME = 'luchuguo'
const SMS_PASSWORD_MD5 = '95895002b700461898a9821c0704e929'
const SMS_API_URL = 'https://api.smsbao.com/sms'
```

### 验证码生成
```typescript
const generateVerificationCode = () => {
  return Math.floor(1000 + Math.random() * 9000).toString()
}
```

### 短信发送
```typescript
const content = `您的验证码是${code}，请在5分钟内完成验证。如非本人操作，请忽略此短信。`
```

### 数据存储
注册成功后，手机号码会保存到 `user_profiles` 表的 `phone` 字段中。

## 错误处理

### 常见错误代码
- `30`: 错误密码
- `40`: 账号不存在
- `41`: 余额不足
- `43`: IP地址限制
- `50`: 内容含有敏感词
- `51`: 手机号码不正确

### 用户友好的错误提示
- 手机号码格式错误：提示正确的格式要求
- 验证码错误：提示重新输入
- 网络错误：显示友好的重试提示

## 安全措施

### 1. 验证码安全
- 验证码为4位随机数字
- 每次发送生成新的验证码
- 验证成功后立即失效

### 2. 手机号码验证
- 严格的格式验证
- 防止恶意注册
- 确保用户身份真实性

### 3. 注册限制
- 必须完成短信验证才能注册
- 防止批量注册和机器人注册
- 提高平台用户质量

## 测试建议

### 1. 功能测试
- 测试不同手机号码格式
- 测试验证码发送和验证
- 测试错误处理机制

### 2. 用户体验测试
- 验证界面友好性
- 测试错误提示清晰度
- 确认流程顺畅性

### 3. 安全测试
- 测试验证码有效期
- 验证防重复注册机制
- 测试异常情况处理

## 注意事项

1. **短信费用**：每次发送验证码会产生短信费用
2. **API限制**：注意短信宝API的调用频率限制
3. **用户体验**：确保验证流程不会过于复杂
4. **错误处理**：提供清晰的错误提示和解决建议
5. **数据安全**：手机号码等敏感信息需要妥善保护

## 后续优化

1. **验证码倒计时**：添加发送验证码的倒计时功能
2. **语音验证码**：提供语音验证码作为备选方案
3. **图形验证码**：在发送短信前增加图形验证码
4. **黑名单机制**：对恶意注册的手机号码进行限制
5. **注册统计**：添加注册成功率和转化率统计 