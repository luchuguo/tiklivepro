# 两步注册页面使用指南

## 概述

基于现有的注册功能，我们创建了一个独立的两步注册页面 (`/signup`)，为用户提供更完整、更专业的注册体验。这个页面不会影响原有的注册按钮功能。

## 功能特性

### 1. 两步注册流程
- **第一步**: 基本信息注册（用户类型、邮箱、密码）
- **第二步**: 个人信息填写（姓名、手机、企业信息等）

### 2. 用户类型选择
- **达人主播**: 适合内容创作者、KOL、主播等
- **企业用户**: 适合品牌方、商家、企业等

### 3. 双重验证系统
- **邮箱验证**: 使用 AOKSend 邮件服务发送6位验证码
- **手机验证**: 使用短信宝API发送4位验证码

### 4. 个人信息收集
- **基础信息**: 姓名、手机号码
- **企业信息**: 公司名称、所属行业、公司简介（仅企业用户）
- **个人简介**: 个人描述（达人主播）

### 5. 表单验证
- 实时验证邮箱格式
- 验证码验证状态提示
- 分步验证，确保数据完整性
- 错误信息友好展示

### 擅长领域选择

达人主播可以选择以下预定义的擅长领域：
- **美妆护肤**: 化妆品、护肤品、美容技巧
- **家居厨房用品**: 厨房用具、家居用品、生活必需品
- **清洁类工具**: 清洁用品、清洁工具、卫生用品
- **宠物用品**: 宠物食品、宠物玩具、宠物护理
- **时尚服饰配件**: 服装、配饰、时尚单品
- **数码配件**: 手机配件、电脑配件、数码周边
- **身体护理**: 身体护理、个人护理、健康用品
- **珠宝首饰**: 珠宝、首饰、配饰
- **美食饮品**: 食品、饮料、零食
- **其他**: 其他专业领域

用户可以通过复选框形式选择多个擅长领域，支持多选。

## 页面路由

- **URL**: `/signup`
- **组件**: `src/components/pages/SignupPage.tsx`
- **路由配置**: 已在 `src/App.tsx` 中添加
- **独立访问**: 不影响原有注册模态框功能

## 访问方式

### 1. 直接访问
```
https://yourdomain.com/signup
```

### 2. 程序跳转
```typescript
import { useNavigate } from 'react-router-dom'

const navigate = useNavigate()
navigate('/signup')
```

### 3. 原有功能保持不变
- 顶部导航栏的"注册"按钮仍然打开原有的 `AuthModal`
- 主页 Hero 区域的按钮仍然打开原有的 `AuthModal`
- 新的注册页面作为独立功能存在

## 两步流程详解

### 第一步：基本信息
1. **选择用户类型**
   - 达人主播：适合内容创作者
   - 企业用户：适合品牌方

2. **邮箱注册**
   - 输入邮箱地址
   - 发送邮箱验证码
   - 验证邮箱验证码

3. **密码设置**
   - 设置登录密码（至少6位）
   - 确认密码
   - 密码显示/隐藏切换

4. **验证通过后**
   - 点击"下一步"进入第二步

### 第二步：信息完善
1. **基础个人信息**
   - 姓和名（必填）
   - 手机号码（必填）

2. **手机验证**
   - 发送短信验证码
   - 验证短信验证码

3. **扩展信息**
   - **达人主播**: 
     - **基础信息区域**：昵称（必填）、所在地
     - **TikTok账号信息区域**：账号（必填）、链接（必填）、粉丝数量（必填）、平均播放量、平均互动率、是否开通小黄车
     - **专业信息区域**：时薪（美元/小时）、经验年限（年）、擅长领域（复选框选择）、技能标签
     - **直播信息区域**：直播场地、双语直播、支持的语言、每周直播档期和时长
     - **身份认证区域**：证件类型（身份证、护照、港澳通行证、台湾通行证、驾照、其他）、证件号码、身份证明图片（填写可获得认证达人标识）
     - **个人简介**：详细个人介绍
   - **企业用户**: 
     - 公司名称（必填）
     - 联系人
     - 营业执照
     - 所属行业（下拉选择）
     - 公司规模（下拉选择）
     - 官网
     - 公司简介

4. **完成注册**
   - 点击"递交注册"完成整个流程

## 技术实现

### 1. 组件结构
```typescript
export function SignupPage() {
  const [currentStep, setCurrentStep] = useState(1)
  
  // 第一步状态
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [emailVerified, setEmailVerified] = useState(false)
  
  // 第二步状态
  const [firstName, setFirstName] = useState('')
  const [phoneNumber, setPhoneNumber] = useState('')
  const [smsVerified, setSmsVerified] = useState(false)
  
  // 验证函数
  const validateStep1 = () => { /* 第一步验证逻辑 */ }
  const validateStep2 = () => { /* 第二步验证逻辑 */ }
}
```

### 2. 核心功能
- **步骤管理**: `currentStep` 状态控制显示内容
- **邮箱验证**: `sendEmailCode()` 和 `verifyEmailCode()`
- **手机验证**: `sendSmsCode()` 和 `verifySmsCode()`
- **分步验证**: `validateStep1()` 和 `validateStep2()`
- **用户注册**: `signUp()` 通过 `useAuth` hook

### 3. 样式设计
- 使用 Tailwind CSS
- 响应式设计，支持移动端
- 渐变色彩主题 (pink-500 到 purple-600)
- 步骤指示器，清晰显示当前进度

## 环境配置

### 1. 邮件服务配置
```typescript
const EMAIL_API_URL = 'https://www.aoksend.com/index/api/send_email'
const EMAIL_API_KEY = import.meta.env.VITE_AOKSEND_API_KEY
const EMAIL_TEMPLATE_ID = 'E_125139060306'
```

### 2. 短信服务配置
```typescript
const SMS_USERNAME = 'luchuguo'
const SMS_PASSWORD_MD5 = '95895002b700461898a9821c0704e929'
const SMS_API_URL = 'https://api.smsbao.com/sms'
```

### 3. 环境变量
确保在 `.env.local` 文件中配置：
```
VITE_AOKSEND_API_KEY=your_api_key_here
```

## 用户体验流程

### 完整流程
1. **访问注册页面** → 直接访问 `/signup` 或程序跳转
2. **第一步：基本信息**
   - 选择用户类型（达人主播/企业用户）
   - 输入邮箱地址
   - 发送并验证邮箱验证码
   - 设置密码和确认密码
   - 点击"下一步"
3. **第二步：个人信息**
   - 填写姓名（姓和名）
   - 输入手机号码
   - 发送并验证短信验证码
   - 填写扩展信息（根据用户类型）
   - 点击"递交注册"
4. **注册完成** → 跳转到登录页面

### 导航控制
- **步骤指示器**: 显示当前进度（第一步/第二步）
- **按钮状态**: 根据验证状态启用/禁用按钮
- **返回功能**: 第二步可以返回第一步修改信息

## 错误处理

### 1. 第一步验证错误
- 邮箱格式无效
- 邮箱验证码错误
- 密码长度不足
- 密码不匹配

### 2. 第二步验证错误
- 姓名未填写
- 手机号码格式错误
- 短信验证码错误
- 企业用户公司名称未填写

### 3. 系统错误
- 网络连接问题
- 服务不可用
- 注册失败

## 与原有功能的区别

### 1. 功能完整性
- **原有模态框**: 基础注册功能
- **新注册页面**: 完整的两步注册流程，包含更多信息收集

### 2. 用户体验
- **原有模态框**: 快速注册，适合简单场景
- **新注册页面**: 专业注册，适合需要完整信息的场景

### 3. 数据收集
- **原有模态框**: 基础用户信息
- **新注册页面**: 完整的用户档案信息

### 4. 使用场景
- **原有模态框**: 快速注册、临时用户
- **新注册页面**: 正式注册、需要完整信息的用户

## 数据保存说明

### 数据库表结构

注册流程会将用户信息保存到以下数据库表：

#### 1. user_profiles 表（基础用户信息）
- `user_id`: 用户ID
- `user_type`: 用户类型（influencer/company）
- `phone`: 手机号码
- `created_at`: 创建时间
- `updated_at`: 更新时间

#### 2. influencers 表（达人主播详细信息）
- `user_id`: 用户ID
- `nickname`: 昵称
- `real_name`: 真实姓名
- `tiktok_account`: TikTok账号
- `bio`: 个人简介
- `location`: 所在地
- `categories`: 擅长领域（数组）
- `tags`: 技能标签（数组）
- `hourly_rate`: 时薪
- `experience_years`: 经验年限
- `id_type`: 证件类型
- `id_number`: 证件号码
- `id_image_url`: 身份证明图片URL
- `tiktok_profile_url`: TikTok账号链接
- `tiktok_followers_count`: TikTok粉丝数量
- `avg_play_count`: 平均播放量
- `avg_engagement_rate`: 平均互动率（百分比）
- `has_tiktok_shop`: 是否开通TikTok Shop
- `live_venue`: 直播场地
- `weekly_schedule`: 每周直播档期和时长（JSON格式）
- `bilingual_live`: 是否可以双语直播
- `languages`: 支持的语言（数组）
- `followers_count`: 粉丝数量（初始为0）
- `is_verified`: 是否认证
- `is_approved`: 是否审核通过
- `rating`: 评分（初始为0）
- `total_reviews`: 总评价数（初始为0）
- `total_live_count`: 总直播次数（初始为0）
- `avg_views`: 平均观看数（初始为0）
- `status`: 状态（active/inactive/suspended）
- `created_at`: 创建时间
- `updated_at`: 更新时间

#### 3. companies 表（企业用户详细信息）
- `user_id`: 用户ID
- `company_name`: 公司名称
- `contact_person`: 联系人
- `business_license`: 营业执照
- `industry`: 所属行业
- `company_size`: 公司规模
- `website`: 官网
- `description`: 公司简介
- `is_verified`: 是否认证
- `created_at`: 创建时间
- `updated_at`: 更新时间

### 数据保存流程

1. **用户账户创建**: 在 Supabase Auth 中创建用户账户
2. **基础资料保存**: 将基本信息保存到 `user_profiles` 表
3. **详细资料保存**: 根据用户类型保存到 `influencers` 或 `companies` 表
4. **状态初始化**: 设置初始状态（未认证、未审核等）

### 数据完整性

- 所有必填字段都会进行验证
- 可选字段如果为空会设置为 `null`
- 数组字段（categories、tags）会保存为 JSON 格式
- 数字字段会进行类型转换
- 时间字段会自动生成

### 错误处理

如果任何一步保存失败，整个注册流程会回滚：
- 不会创建用户账户
- 不会保存任何数据
- 返回具体的错误信息

## 维护和扩展

### 1. 添加新字段
在相应的步骤中添加新的状态和表单字段

### 2. 修改验证逻辑
在 `validateStep1()` 或 `validateStep2()` 函数中添加新的验证规则

### 3. 增加新步骤
通过修改 `currentStep` 逻辑和添加新的步骤内容

### 4. 样式定制
修改 Tailwind CSS 类名或添加自定义样式

### 5. 国际化支持
可以集成现有的多语言系统

## 测试建议

### 1. 功能测试
- 两步流程的完整性
- 邮箱验证流程
- 手机验证流程
- 用户类型选择
- 表单验证逻辑

### 2. 响应式测试
- 移动端显示效果
- 平板端显示效果
- 桌面端显示效果

### 3. 错误处理测试
- 网络错误情况
- 验证码错误
- 表单验证错误
- 步骤切换逻辑

### 4. 兼容性测试
- 与原有注册功能的兼容性
- 不影响现有用户流程

## 总结

新的两步注册页面提供了：

### 优势
- **完整的信息收集**: 两步流程确保数据完整性
- **专业的用户体验**: 清晰的步骤指引和验证流程
- **双重验证保障**: 邮箱+手机双重验证
- **灵活的用户类型**: 支持达人主播和企业用户
- **独立功能**: 不影响原有注册功能

### 适用场景
- 需要完整用户信息的正式注册
- 企业用户入驻
- 达人主播认证
- 需要手机验证的重要账户

### 技术特点
- 基于现有注册逻辑，保持一致性
- 响应式设计，支持多端访问
- 完善的错误处理和用户反馈
- 模块化设计，易于维护和扩展

这个页面完全基于您现有的注册功能，保持了功能的一致性，同时提供了更专业、更完整的注册体验。

## 图片上传接口

注册页面和达人编辑资料页面都使用 **PICUI 图床 API** 进行图片上传：

### 接口详情

**接口地址**: `https://picui.cn/api/v1/upload`

**请求方式**: `POST`

**请求头**:
```javascript
{
  'Authorization': `Bearer ${import.meta.env.VITE_PICUI_API_KEY}`,
  'Accept': 'application/json'
}
```

**请求体**: `FormData`
```javascript
const formData = new FormData()
formData.append('file', file)           // 图片文件
formData.append('permission', '1')      // 公开权限
```

### 环境变量配置

需要在环境变量文件中配置 `VITE_PICUI_API_KEY`：

```env
VITE_PICUI_API_KEY=your_picui_api_key_here
```

### 支持的图片上传功能

1. **注册页面**: 身份证明图片上传
2. **达人编辑资料**: 个人头像上传
3. **企业编辑资料**: Logo上传

### 实现特点

- **统一接口**: 所有图片上传都使用相同的 PICUI API
- **公开访问**: 上传的图片设置为公开权限，可直接访问
- **错误处理**: 完整的错误处理和用户提示
- **预览功能**: 上传成功后立即显示预览
- **日志记录**: 详细的上传过程日志，便于调试 

### 短信验证功能

- **自动验证**: 输入4位验证码后自动验证，无需手动点击
- **手动验证**: 也可以点击"验证"按钮手动验证
- **实时反馈**: 验证成功后立即显示成功提示
- **错误处理**: 验证失败时显示具体错误信息 

### 图片上传功能

- **支持格式**: JPG、PNG 格式，文件大小不超过 5MB
- **上传状态**: 显示"上传中..."提示，防止重复操作
- **全局遮罩**: 上传过程中显示全屏遮罩，禁止其他操作
- **实时预览**: 上传成功后立即显示图片预览
- **错误处理**: 上传失败时显示具体错误信息 

### 注册完成流程

注册成功后系统会自动执行以下操作：
1. **清空缓存**: 清除 localStorage 和 sessionStorage 中的所有数据
2. **退出登录**: 调用 Supabase Auth 的 signOut 方法
3. **显示提示**: 弹出"注册成功！请重新登录。"的提示框
4. **跳转首页**: 自动跳转到网站首页
5. **重新登录**: 用户需要在首页重新登录才能使用系统

这个流程确保了注册完成后用户状态的完全重置，避免数据冲突。 

## 注册入口统一

所有页面的注册入口都已统一指向 `/signup` 页面：

### 主要注册入口
1. **导航栏注册按钮**: 点击"注册"按钮直接跳转到注册页面
2. **Hero区域按钮**: 
   - "达人入驻"按钮
   - "品牌方入驻"按钮
3. **移动端菜单**: 移动端菜单中的"注册"按钮
4. **CTA区域按钮**: 
   - "我是达人"按钮
   - "我是品牌方"按钮
5. **登录框注册入口**: 登录弹窗中的"还没有账号？立即注册"链接

### 用户体验
- 所有注册入口都直接跳转到专业的注册页面
- 不再使用弹窗模式，提供更好的注册体验
- 统一的注册流程，确保数据完整性 